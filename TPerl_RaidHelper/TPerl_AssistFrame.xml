<Ui xmlns="http://www.blizzard.com/wow/ui/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.blizzard.com/wow/ui/ ..\FrameXML\UI.xsd">

	<Script file="TPerl_AssistFrame.lua"/>

	<Frame name="TPerlListTemplate" inherits="TPerlBackdropTemplate" virtual="true">
		<Layers>
			<Layer level="ARTWORK">
				<FontString name="$parentText" inherits="GameFontNormalSmall" justifyH="LEFT" justifyV="TOP">
					<Anchors>
						<Anchor point="TOPLEFT"/>
						<Anchor point="BOTTOMRIGHT"/>
					</Anchors>
				</FontString>
			</Layer>
		</Layers>
	</Frame>

	<Frame name="TPerl_Assists_FrameAnchor" movable="true" resizable="true" parent="UIParent" inherits="TPerlBackdropTemplate" clampedToScreen="true">
		<Size>
			<AbsDimension x="330" y="124"/>
		</Size>
		<Anchors>
			<Anchor point="CENTER"/>
		</Anchors>
	</Frame>

	<Frame name="TPerl_Assists_Frame" frameStrata="LOW" resizable="true" parent="TPerl_Assists_FrameAnchor" inherits="TPerlBackdropTemplate" hidden="true" enableMouse="true" clampedToScreen="true">
		<KeyValues>
			<KeyValue key="backdropInfo" value="TPerl_Raid_Backdrop_32_16_3333" type="global"/>
		</KeyValues>
		<Size>
			<AbsDimension x="330" y="124"/>
		</Size>
		<Anchors>
			<Anchor point="TOPLEFT"/>
		</Anchors>
		<Frames>
			<Button name="TPerlAssistsCloseButton" inherits="UIPanelCloseButton">
				<Size>
					<AbsDimension x="20" y="20"/>
				</Size>
				<Anchors>
					<Anchor point="TOPRIGHT"/>
				</Anchors>
				<Scripts>
					<OnClick>
						TPerl_AssistsView_Close()
					</OnClick>
				</Scripts>
			</Button>

			<Button name="TPerlAssistPin" inherits="TPerl_BasicButton">
				<Size>
					<AbsDimension x="11" y="11"/>
				</Size>
				<Anchors>
					<Anchor point="RIGHT" relativeTo="TPerlAssistsCloseButton" relativePoint="LEFT">
						<Offset>
							<AbsDimension x="4" y="0"/>
						</Offset>
					</Anchor>
				</Anchors>
				<NormalTexture file="Interface\Addons\TPerl_RaidHelper\Images\TPerl_Pin">
					<TexCoords left="0" right="0.46875" top="0" bottom="0.453125"/>
				</NormalTexture>
				<PushedTexture file="Interface\Addons\TPerl_RaidHelper\Images\TPerl_Pin">
					<TexCoords left="0" right="0.46875" top="0.5" bottom="0.953125"/>
				</PushedTexture>
				<HighlightTexture file="Interface\Buttons\UI-Panel-MinimizeButton-Highlight" alphaMode="ADD">
					<TexCoords left="0" right="0.9" top="0.1" bottom="0.9"/>
				</HighlightTexture>
				<Scripts>
					<OnLoad>
						self.SetButtonTex = function()
							local tex = TPerlAssistPin:GetNormalTexture()
							if (TPerlConfigHelper and TPerlConfigHelper.AssistPinned) then
								tex:SetTexCoord(0.5, 0.96875, 0, 0.453125)
							else
								tex:SetTexCoord(0, 0.46875, 0, 0.453125)
							end

							tex = TPerlAssistPin:GetPushedTexture()
							if (TPerlConfigHelper and TPerlConfigHelper.AssistPinned) then
								if (TPerl_Assists_Frame.corner) then
									TPerl_Assists_Frame.corner:Hide()
								end
								tex:SetTexCoord(0.5, 0.96875, 0.5, 0.953125)
							else
								if (TPerl_Assists_Frame.corner) then
									TPerl_Assists_Frame.corner:Show()
								end
								tex:SetTexCoord(0, 0.46875, 0.5, 0.953125)
							end
						end
						self.tooltipText = TPERL_BUTTON_HELPER_PIN
					</OnLoad>
					<OnClick>
						TPerlConfigHelper.AssistPinned = not TPerlConfigHelper.AssistPinned
						self:SetButtonTex()
					</OnClick>
				</Scripts>
			</Button>

			<ScrollFrame name="TPerl_Target_Targetting_ScrollFrame">
				<Anchors>
					<Anchor point="TOPLEFT">
						<Offset>
							<AbsDimension x="4" y="-5"/>
						</Offset>
					</Anchor>
					<Anchor point="BOTTOMRIGHT" relativePoint="BOTTOM">
						<Offset>
							<AbsDimension x="-1" y="4"/>
						</Offset>
					</Anchor>
				</Anchors>
				<ScrollChild>
					<Frame name="TPerl_Target_Assists_ScrollChild_Targetting" inherits="TPerlListTemplate">
						<Size>
							<AbsDimension x="300" y="400"/>
						</Size>
					</Frame>
				</ScrollChild>
				<Scripts>
					<OnMouseDown>
						TPerl_Assists_MouseDown(TPerl_Assists_Frame, button, "targetFrame")
					</OnMouseDown>
					<OnMouseUp>
						TPerl_Assists_MouseUp(TPerl_Assists_Frame, button, "targetFrame")
					</OnMouseUp>
					<OnSizeChanged>
						TPerl_Target_Assists_ScrollChild_Targetting:SetWidth(TPerl_Target_Targetting_ScrollFrame:GetWidth() / TPerl_Target_Targetting_ScrollFrame:GetEffectiveScale())
					</OnSizeChanged>
				</Scripts>
			</ScrollFrame>
			<ScrollFrame name="TPerl_Target_Assists_ScrollFrame">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="TOP">
						<Offset>
							<AbsDimension x="0" y="-5"/>
						</Offset>
					</Anchor>
					<Anchor point="BOTTOMRIGHT">
						<Offset>
							<AbsDimension x="-4" y="4"/>
						</Offset>
					</Anchor>
				</Anchors>
				<ScrollChild>
					<Frame name="TPerl_Target_Assists_ScrollChild_Assists" inherits="TPerlListTemplate">
						<Size>
							<AbsDimension x="300" y="400"/>
						</Size>
					</Frame>
				</ScrollChild>
				<Scripts>
					<OnSizeChanged>
						TPerl_Target_Assists_ScrollChild_Assists:SetWidth(TPerl_Target_Assists_ScrollFrame:GetWidth() / TPerl_Target_Assists_ScrollFrame:GetEffectiveScale())
					</OnSizeChanged>
					<OnMouseDown>
						TPerl_Assists_MouseDown(TPerl_Assists_Frame, button)
					</OnMouseDown>
					<OnMouseUp>
						TPerl_Assists_MouseUp(TPerl_Assists_Frame, button)
					</OnMouseUp>
				</Scripts>
			</ScrollFrame>

			<Frame name="TPerlScrollSeperator">
				<Anchors>
					<Anchor point="TOPLEFT" relativePoint="TOPRIGHT" relativeTo="TPerl_Target_Targetting_ScrollFrame"/>
					<Anchor point="BOTTOMRIGHT" relativePoint="BOTTOMLEFT" relativeTo="TPerl_Target_Assists_ScrollFrame"/>
				</Anchors>
				<Layers>
					<Layer level="ARTWORK">
						<Texture file="Interface\AddOns\TPerl_RaidHelper\Images\TPerl_FrameBack" setAllPoints="true"/>
					</Layer>
				</Layers>
			</Frame>
		</Frames>
		<Scripts>
			<OnLoad>
				self:OnBackdropLoaded()
				TPerl_Assists_OnLoad(self)
			</OnLoad>
		</Scripts>
	</Frame>

	<Frame>
		<Scripts>
			<OnLoad>
				self:SetScript("OnUpdate", TPerl_Assists_OnUpdate)
			</OnLoad>
		</Scripts>
	</Frame>

	<!-- These two frames add to TPerl UnitFrames. If TPerl not loaded, then WoW will just ignore these without error -->
	<Button name="TPerl_Player_TargettingFrame" inherits="TPerlBackdropTemplate" enableMouse="true" text="0" hidden="true">
		<KeyValues>
			<KeyValue key="backdropInfo" value="TPerl_Frame_Backdrop_32_16_3333" type="global"/>
		</KeyValues>
		<Size>
			<AbsDimension x="27" y="20"/>
		</Size>
		<NormalFont style="GameFontNormalSmall"/>
		<ButtonText name="$parenttext" setAllPoints="true"/>
		<HighlightTexture file="Interface\Addons\TPerl\Images\TPerl_Highlight" alphaMode="ADD">
			<TexCoords left="0" right="0.25" top="0" bottom="0.5"/>
		</HighlightTexture>
		<!--<Anchors>
			<Anchor point="TOPRIGHT" relativePoint="TOPLEFT" relativeTo="TPerl_PlayerportraitFrame">
				<Offset>
					<AbsDimension x="2" y="-19"/>
				</Offset>
			</Anchor>
		</Anchors>-->
		<Scripts>
			<OnLoad>
				self:OnBackdropLoaded()
				if C_AddOns.IsAddOnLoaded("TPerl_Player") then
					self:SetParent(TPerl_Player)
					self:SetPoint("TOPRIGHT", TPerl_PlayerportraitFrame, "TOPLEFT", 2, -19)
				end
				if (TPerl_RegisterUnitText) then
					TPerl_RegisterUnitText(self)
				end
			</OnLoad>
			<OnClick>
				TPerl_ToggleAssistsFrame("targetting")
				TPerl_SetFrameSides()
				TPerl_ShowAssists()
			</OnClick>
			<OnEnter>
				local title
				if (table.getn(TPerl_Assists_Frame.targetting) > 0 and TPerl_Assists_Frame.targetting[1][2] == "") then
					title = TPERL_TOOLTIP_ENEMYONME
				else
					if (TPerlConfigHelper.TargetCountersSelf == 0) then
						title = TPERL_TOOLTIP_ALLONME
					else
						title = TPERL_TOOLTIP_HEALERS
					end
				end

				local t = TPerl_MakeAssistsString(TPerl_Assists_Frame.targetting, title)
				t = "|c00FFFFFF"..t.."\r|c009F6000"..TPERL_TOOLTIP_HELP
				GameTooltip:SetOwner(self, "ANCHOR_BOTTOMRIGHT")
				GameTooltip:SetText(t)
				GameTooltip:Show()
			</OnEnter>
			<OnLeave>
				TPerl_PlayerTipHide()
			</OnLeave>
		</Scripts>
	</Button>

	<Button name="TPerl_Target_AssistFrame" inherits="TPerlBackdropTemplate" hidden="true">
		<KeyValues>
			<KeyValue key="backdropInfo" value="TPerl_Frame_Backdrop_32_16_3333" type="global"/>
		</KeyValues>
		<Size>
			<AbsDimension x="27" y="20"/>
		</Size>
		<NormalFont style="GameFontNormalSmall"/>
		<ButtonText name="$parenttext" setAllPoints="true"/>
		<HighlightTexture file="Interface\Addons\TPerl\Images\TPerl_Highlight" alphaMode="ADD">
			<TexCoords left="0" right="0.25" top="0" bottom="0.5"/>
		</HighlightTexture>
		<Anchors>
			<Anchor point="TOPLEFT">
				<Offset>
					<AbsDimension x="-2" y="-20"/>
				</Offset>
			</Anchor>
		</Anchors>
		<Scripts>
			<OnLoad>
				self:OnBackdropLoaded()
				if (TPerl_RegisterUnitText) then
					TPerl_RegisterUnitText(self)
				end
			</OnLoad>
			<OnClick>
				TPerl_ToggleAssistsFrame("assists")
				TPerl_SetFrameSides()
				TPerl_ShowAssists()
			</OnClick>
			<OnEnter>
				local t = TPerl_MakeAssistsString(TPerl_Assists_Frame.assists, TPERL_TOOLTIP_ASSISTING)
				t = "|c00FFFFFF"..t.."\r|c009F6000"..TPERL_TOOLTIP_HELP
				GameTooltip:SetOwner(self, "ANCHOR_BOTTOMRIGHT")
				GameTooltip:SetText(t)
				GameTooltip:Show()
			</OnEnter>
			<OnLeave>
				TPerl_PlayerTipHide()
			</OnLeave>
		</Scripts>
	</Button>

	<Frame name="TPerl_AggroAnchor" frameStrata="HIGH" parent="UIParent" inherits="TPerlBackdropTemplate" movable="true">
		<Size>
			<AbsDimension x="32" y="32"/>
		</Size>
		<Anchors>
			<Anchor point="CENTER"/>
		</Anchors>
		<Frames>
			<Frame name="$parentArrows" inherits="TPerlBackdropTemplate" setAllPoints="true">
				<Layers>
					<Layer level="ARTWORK">
						<Texture name="$parenttex" file="Interface\Addons\TPerl_RaidHelper\Images\TPerl_MoveCursor" setAllPoints="true"/>
					</Layer>
				</Layers>
				<Scripts>
					<OnLoad>
						self:RegisterForDrag("LeftButton")
					</OnLoad>
					<OnHide>
						TPerl_AggroAnchor:StopMovingOrSizing()
						if (TPerl_Aggro) then
							TPerl_Aggro:SetScript("OnUpdate", TPerl_RefreshAggro)
							TPerl_AggroPlayer:Hide()
							TPerl_AggroPet:Hide()
							TPerl_Aggro:Hide()
						end
					</OnHide>
					<OnEnter>
						GameTooltip:SetOwner(self, "ANCHOR_CURSOR")
						GameTooltip:SetText(TPERL_AGGRO_DRAGTIP, 1, 1, 1)
					</OnEnter>
					<OnLeave>
						GameTooltip:Hide()
					</OnLeave>
					<OnDragStart>
						TPerl_AggroAnchor:SetFrameStrata("DIALOG")
						GameTooltip:Hide()
						self.tex:Hide()
						TPerl_AggroPlayer:SetVertexColor(0, 0, 1)
						TPerl_AggroPet:SetVertexColor(0, 0, 1)
						TPerl_AggroPlayer:SetAlpha(1)
						TPerl_AggroPet:SetAlpha(1)
						TPerl_AggroPlayer:Show()
						TPerl_AggroPet:Show()
						TPerl_Aggro:SetScript("OnUpdate", nil)
						TPerl_Aggro:Show()
						TPerl_AggroAnchor:StartMoving()
					</OnDragStart>
					<OnDragStop>
						TPerl_AggroAnchor:SetFrameStrata("MEDIUM")
						self.tex:Show()
						TPerl_Aggro:SetScript("OnUpdate", TPerl_RefreshAggro)
						TPerl_AggroAnchor:StopMovingOrSizing()

						TPerl_AggroPlayer:Hide()
						TPerl_AggroPet:Hide()
						TPerl_Aggro:Hide()

						if (TPerl_SavePosition) then
							TPerl_SavePosition(TPerl_AggroAnchor)
						end
					</OnDragStop>
				</Scripts>
			</Frame>
		</Frames>
		<Scripts>
			<OnLoad>
				TPerl_SetChildMembers(self)

				self.Enable = function(self)
					self.Arrows:Show()
					self:EnableMouse(true)
					self:SetFrameStrata("MEDIUM")
				end
				self.Disable = function(self)
					self.Arrows:Hide()
					self:EnableMouse(false)
					self:SetFrameStrata("HIGH")
				end

				self:Disable()
			</OnLoad>
		</Scripts>
	</Frame>

	<Frame name="TPerl_Aggro" parent="TPerl_AggroAnchor" inherits="TPerlBackdropTemplate" hidden="true">
		<Scripts>
			<OnLoad>
				self:SetScript("OnUpdate", TPerl_RefreshAggro)
			</OnLoad>
			<OnHide>
				self.playerFadeStart = nil
				self.petFadeStart = nil
			</OnHide>
		</Scripts>
		<Size>
			<AbsDimension x="256" y="64"/>
		</Size>
		<Anchors>
			<Anchor point="CENTER"/>
		</Anchors>
		<Layers>
			<Layer level="OVERLAY">
				<FontString name="$parentPlayer" outline="THICK" font="GameFont_Gigantic" justifyH="CENTER" text="TPERL_AGGRO_PLAYER" hidden="true">
					<FontHeight>
						<AbsValue val="42"/>
					</FontHeight>
				</FontString>
				<FontString name="$parentPet" outline="THICK" font="SystemFont_Huge1" justifyH="CENTER" text="TPERL_AGGRO_PET" hidden="true">
					<Anchors>
						<Anchor point="TOP" relativeTo="$parentPlayer" relativePoint="BOTTOM" />
					</Anchors>
					<FontHeight>
						<AbsValue val="16"/>
					</FontHeight>
				</FontString>
			</Layer>
		</Layers>
	</Frame>
</Ui>
